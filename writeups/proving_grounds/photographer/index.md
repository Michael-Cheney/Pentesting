# Photographer

**IP Address:** 192.168

## Enumeration
### Open Ports
| Port #| Service | Details  |
|:------|:---------|:---------|
| 22    | ssh      | OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) |
| 80    | http     | Apache httpd 2.4.18 ((Ubuntu)) |
| 139   | smb      | Samba smbd 3.X - 4.X (workgroup: WORKGROUP) | 
| 445   | smb      | Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) | 
| 8000  | http     | Apache httpd 2.4.18 ((Ubuntu)) |

## Exploitation
### Exploit Details (SearchSploit)
* **Name** - Koken CMS 0.22.24 - Arbitrary File Upload (Authenticated) 
* **CVE** - N/A
* **Module** - php/webapps/48706.txt
* **Disclosed** - 2020-07-26 
* **References**
  * https://www.exploit-db.com/exploits/48706

Potential credentials were found on an SMB share (daisa@photographer.com:babygirl). These credentials were found to work with the admin console for the koken server (http://192.168.76.76:8000/admin/). 

1. Login to the admin console with the found credentials

![Execute Exploit](images/exploit1.png)

2. Create a shell named as shell.php.jpg and go to Library > Import Content

![Execute Exploit](images/exploit2.png)

3. Select the file shell that was created but don't click import yet. 

![Execute Exploit](images/exploit3.png)

4. Start Burp Suite and set it to intercept requests. 

![Execute Exploit](images/exploit4.png)

5. Click on the import button 

![Execute Exploit](images/exploit5.png)

6. Switch to Burp Suite and edit the request as shown. Removing '.jpg' from the end of the filename. Then click 

![Execute Exploit](images/exploit6.png)

![Execute Exploit](images/exploit7.png)

7. Right click on 'Download File' and select 'Copy Link Location'. 

![Execute Exploit](images/exploit8.png)

8. Curl the link location to get a reverse shell. 

![Execute Exploit](images/exploit9.png)

Commands
```bash
python -c 'import pty;pty.spawn("/bin/bash")'
whoami
cat /home/daisa/local.txt
ifconfig
```
![Execute Exploit](images/exploit10.png)

## Privilege Escalation
### Exploit Details
* **Name** - SUID (php) 
* **CVE** - N/A
* **Module** - 
* **Disclosed** - 
* **References**
  * https://gtfobins.github.io/gtfobins/php/

Commands
```
CMD="/bin/sh"
/usr/bin/php7.2 -r "pcntl_exec('/bin/sh', ['-p']);"
whoami
cat /root/proof.txt
ifconfig
```
![Execute Exploit](images/privesc1.png)