# Stored XSS
## Requirements
* Stored data within the application
* Persistent
* Affects any users who visits the page attack vector
* Stored input is not filtered correctly
* Most dangerous attack as it does not require user interaction
* Second order XSS

## Attack Scenario
* Attacker stores malicious code into vulnerable page
* User authenticates in the application
* User visits vulnerable page
* Malicious code executes

## Method
* Attacker creates and tests an offending URI
* Attacker waits until victim visits vulnerable webpage
* Eventual execution of payload on victim browser

## Challenges
* Proper character encoding
  * Sometimes `<script>` might be filtered
  * But `%3cscript%3e` is not
    * `%3c = <`
    * `%3e = >`
* Most dangerous in areas where users can have higher privileges
* Attack is automatically executed by the browser

## Test objectives
* Identify the stored input and where it is reflected in the client side
* Assess the input they accept and see if we can't pass around any filters

## How to test
* Detect input vectors
  * Tester must define all user controller variables and parameters
    * User/Profiles page: the application allows the user to edit/change profile details such as first name, last name, nickname, avatar, picture, address, etc. 
    * Shopping cart: the application allows the user to store items into the shopping cart which can then be reviewed later
    * File Manager: application that allows upload of files
    * Application settings/preferences: application that allows the user to set preferences
    * Forum/Message board: application that permits exchange of posts among users
    * Blog: if the blog application permits to users submitting components
    * Log: if the application stores some users input into the logs 
* Analysing input vectors
  * Tester will try specially crafted input vectors for every parameter
    * Example HTML tag attribute context
      * `"><script>alert()</script>`
    * HTML Context
      * `<img src=x onerror=submit()>
  * https://owasp.org/www-community/xss-filter-evasion-cheatsheet
* Analyse HTML code
  * Input stored by application is usually used in tags
  * Can also be found in JS context
  * Tester should investigate out of band channels such as customer support for blind XSS
* ALL DATA MUST BE TESTED BY INSERTING IN USER AREAS AND VIEWING IN ADMIN AREAS
* Blind XSS with BeEF
  * Injecting a JavaScript hook which communicates to the attacker's browser exploitation framework (BeEF)
  * Waiting for the application user to vview the vulnerable page where the stored input is displayed
  * Control the application user's browser via the BeEF console
* File upload
  * Name of the file might be vulnerable

## Tools
* PHP Charset Encoder(PCE) - helps you encode arbitrary text to and from 65 kinds of character sets that you can use in your customized payloads. 
* Hackvertor - is an online tool which allows many types of encoding and obfuscation of JavaScript (or any string input)
* XSS Assistant Greasemonkey script that allow users to easily test any web application for vcross-site-scripting flaws. 
* BeEF is the browser exploitation framework. A professional tool to demonstrate the real-time impact of browser vulnerabilities.
* Burp Proxy - is an interactive HTTP/S proxy server for attacking and testing web applications. 
* OWASP Zed Attack Proxy (ZAP) - is an interactive HTTP/S proxy server for attacking and testing web applications with a built-in scanner.