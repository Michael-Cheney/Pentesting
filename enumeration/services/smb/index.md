# SMB
## SMB Version	& Operating System
| Version | Operating System(s) |
| ------------|-----------------|
| CIFS | Microsoft Windows NT 4.0 |
| SMB 1.0 |	Windows 2000, Windows XP, Windows Server 2003 and Windows Server 2003 R2 |
| SMB 2.0	| Windows Vista & Windows Server 2008 |
| SMB 2.1	| Windows 7 and Windows Server 2008 R2 |
| SMB 3.0	| Windows 8 and Windows Server 2012 |
| SMB 3.0.2 |	Windows 8.1 and Windows Server 2012 R2 |
| SMB 3.1.1	| Windows 10 and Windows Server 2016 |

## Initial Scans
| Command | Description | Command  |
| ------------|----------------------| -----------------------------|
| nbtscan     | netbios scan         | `nbtscan -r $ip`             |
| nmblookup   | Enumerate Hostname   | `nmblookup -A $ip`           |
| smbmap      | List Shares          | `smbmap -H $ip -u guest` |
| smbclient   | List Shares          | `smbclient -L \\$ip` |
| crackmapexec | List Shares (Other stuff) | `crackmapexec smb $ip --shares` |
| nmap        | List Shares          | `nmap --script smb-enum-shares -p 139,445 $ip` |
| smbmap      | List Shares with creds | `smbmap -u $user -p $password -R -H $ip_or_dns` | 
| enum4linux  | Exhaustive Scan      | `enum4linux -a -M -l -d $ip` |
| smbmap      | Check Null Sessions      | `smbmap -H $ip` |
| rpcclient   | Check Null Sessions      | `rpcclient -U "" -N $ip` |
| smbclient   | Check Null Sessions      | `enum4linux -a -M -l -d $ip` |
| smbmap      | Check Null Sessions      | `smbclient \\\\$ip\\[share name]` |
| nmap        | Vulnerability scan | `nmap --script smb-vuln* -p 139,445 $ip`|
| crackmapexec | Verify Credentials | `crackmapexec smb $ip_or_dns -u $user -p $password` | 

## Connect to shares
| Command | Description | Command  |
| ------------|----------------------| --------------------|
| nbtscan     | Connect         | `smbclient //$ip/$share` |
| nmblookup   | Connect with credentials  | `smbclient //$ip/$share -U "administrator"` | 
| smbmap      | Recursively List Contents | `smbmap -H $ip --depth 10 -R $share` |
| smbclient   | Connect with credentials | `smbclient \\\\$ip\\$share -U "$user" -p "$password"` |

## Check Share Permissions
| Info | Command |
|:-----|:--------|
| Check share permissions | `smbcacls --no-pass //$ip/$share` |

## Download Files
| Command | Description | Command  |
| ------------|----------------------| --------------------|
| generic | After connected run commands in order | `RECURSE ON` |
| generic | After connected run commands in order | `PROMPT OFF` |
| generic | After connected run commands in order | `mget *` |
| smbmap | Download specific file | `smbmap -H $ip --depth 10 -R $share --depth 10 -A Groups.xml -q` |